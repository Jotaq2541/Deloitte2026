<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Asistente Virtual ‚Äì Deloitte CA</title>
  <meta name="description" content="Asistente con voz neutral latinoamericana. Preguntas y respuestas sobre el Marketplace Deloitte Centroam√©rica." />

  <style>
    :root{
      --bg:#0b0e11; --panel:#111418; --card:#141a1f;
      --brand:#1c8c3f; --brand-2:#22b36a;
      --text:#ffffff; --muted:#b9c0c7; --focus:#8bd8a9;
      --viz-text:#eaf7ef; --viz-muted:#b9c0c7;
      --viz-bg:#0f1216; --viz-stroke:#2e3640;

      --chip-bg:#eef6f0; --chip-text:#0b0e11; --chip-border:rgba(0,0,0,.16);
      --chip-bg-hover:#e4f2ea;

      --glow: rgba(34,179,106,.55);
      --glow-soft: rgba(34,179,106,.18);
    }
    *{box-sizing:border-box}

    body{
      margin:0;
      background:radial-gradient(1200px 600px at 20% 0%,#0e1117 0%,var(--bg) 60%);
      color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      position:relative; min-height:100dvh; overflow-x:hidden;
    }

    /* Fondo decorativo */
    .fx-grid{
      position:fixed; inset:0; z-index:-2; pointer-events:none;
      background:
        radial-gradient(1200px 600px at 15% 0%, rgba(34,179,106,.12), transparent 60%),
        repeating-linear-gradient(135deg, rgba(34,179,106,.06) 0 2px, transparent 2px 18px);
      mix-blend-mode:screen; animation: bgShift 36s linear infinite;
    }
    .fx-glow{
      position:fixed; inset:0; z-index:-1; pointer-events:none;
      background:
        radial-gradient(800px 400px at 80% 20%, rgba(34,179,106,.12), transparent 60%),
        radial-gradient(700px 380px at 20% 80%, rgba(28,140,63,.10), transparent 60%);
      filter: blur(14px);
    }
    @keyframes bgShift{ 0%{background-position:0 0,0 0} 100%{background-position:0 0,480px 280px} }

    header{
      padding:16px 20px;
      border-bottom:2px solid var(--brand);
      background:linear-gradient(180deg, rgba(15,19,23,.92), rgba(15,19,23,.78));
      backdrop-filter: blur(6px);
      display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap;
      box-shadow: 0 10px 24px rgba(0,0,0,.35);
    }
    .brand{display:flex;align-items:center;gap:10px}
    .logo{height:24px;width:auto;display:block}
    .logo-fallback{height:24px;display:none;align-items:center;color:#cfe9d5;font-weight:700}
    header h1{
      margin:0;font-size:18px;font-weight:700;white-space:nowrap;
      text-shadow: 0 1px 0 rgba(0,0,0,.6);
    }

    .controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    label{display:flex;gap:6px;align-items:center}
    select,button{
      background:#f1f5f3; color:#0b0e11;
      border:1px solid rgba(0,0,0,.18);
      border-radius:10px; padding:8px 10px; font-size:14px;
      box-shadow:0 1px 0 rgba(255,255,255,.15) inset, 0 6px 14px rgba(0,0,0,.15);
      cursor:pointer; transition: box-shadow .18s ease, transform .18s ease, border-color .18s ease;
    }
    select:hover,button:hover{
      border-color: rgba(28,140,63,.35);
      box-shadow: 0 0 0 1px rgba(34,179,106,.25), 0 10px 22px rgba(0,0,0,.22);
      transform: translateY(-1px);
    }
    .btn-primary{
      background:linear-gradient(180deg,#27ae60,#1c8c3f);
      color:#ffffff;border:1px solid #1c8c3f
    }
    .btn-ghost{background:#e9efe9}
    .controls select:focus-visible,.controls .btn:focus-visible{outline:2px solid var(--focus);outline-offset:2px}

    .wrap{display:grid;grid-template-columns:360px 1fr;gap:16px;padding:16px}
    @media (max-width:1100px){ .wrap{grid-template-columns:1fr} }

    .left,.right{
      background:
        linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.00) 200px);
      border:1px solid rgba(255,255,255,.08);
      border-radius:14px;
      box-shadow:
        0 14px 32px rgba(0,0,0,.38),
        inset 0 1px 0 rgba(255,255,255,.06);
      position:relative; overflow:clip;
    }
    .left::before,.right::before{
      content:""; position:absolute; inset:0; pointer-events:none;
      border-radius:inherit;
      box-shadow: 0 0 0 1px rgba(34,179,106,.12), 0 0 32px rgba(34,179,106,.08) inset;
    }
    .left{padding:14px;display:grid;grid-template-rows:auto auto 1fr;gap:14px}

    /* Avatar */
    .avatar{
      position:relative;aspect-ratio:4/5;border-radius:12px;overflow:hidden;
      background:#07090d;border:1px solid rgba(32,163,74,.35);
      box-shadow:0 0 0 1px rgba(32,163,74,.12),0 18px 60px rgba(0,0,0,.35)
    }
    .avatar img,.avatar video{
      position:absolute;inset:0;width:100%;height:100%;
      object-fit:cover;object-position:center;display:block
    }
    .subtitle{
      position:absolute;bottom:8px;left:8px;right:8px;background:rgba(0,0,0,.45);
      backdrop-filter:blur(4px);padding:8px;border-radius:8px;font-size:12px;max-height:38%;overflow:auto
    }

    .muted{color:var(--muted);font-size:12px}

    .right{display:grid;grid-template-rows:auto auto 1fr auto; position:relative;}
    .panel{
      padding:12px 14px;border-bottom:1px solid rgba(255,255,255,.08);
      display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap
    }
    .panel h2{margin:0;font-size:16px}

    .grid{
      display:grid; grid-template-columns: repeat(2, minmax(0, 1fr));
      gap:12px; padding:14px; background:rgba(0,0,0,.18); align-items:start;
    }
    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
    }

    .card{
      background:var(--viz-bg); border:1px solid rgba(255,255,255,.08); border-radius:12px; padding:12px; position:relative;
      box-shadow: 0 18px 40px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.06);
      transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
    }
    .card:hover{
      transform: translateY(-2px);
      box-shadow: 0 24px 56px rgba(0,0,0,.48), inset 0 1px 0 rgba(255,255,255,.08);
      border-color: rgba(34,179,106,.28);
    }

    .qbtn{
      width:100%;text-align:left;padding:12px;border:1px solid rgba(255,255,255,.06);
      background:#12151b;border-radius:10px;cursor:pointer;line-height:1.35;
      transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease, background .35s ease;
      box-shadow: 0 1px 0 rgba(255,255,255,.06) inset, 0 8px 20px rgba(0,0,0,.25);
    }
    .qbtn:hover{
      border-color:rgba(32,163,74,.55);
      box-shadow:0 0 6px rgba(32,163,74,.24), 0 0 18px rgba(32,163,74,.12) inset, 0 10px 26px rgba(0,0,0,.35);
      transform: translateY(-1px);
    }
    .qbtn:active{
      background: linear-gradient(90deg, rgba(28,140,63,.15) 0%, rgba(32,163,74,.4) 50%, rgba(28,140,63,.15) 100%);
    }
    .qbtn:focus-visible{outline:2px solid var(--focus);outline-offset:2px}

    .answer{padding:16px;border-top:1px solid rgba(255,255,255,.08);background:#101419;min-height:160px}
    footer{padding:10px 16px;color:var(--muted)}
    .kbd{border:1px solid rgba(255,255,255,.2);padding:0 6px;border-radius:6px;background:#0f1216}

    /* Avatar animaci√≥n al hablar */
    #avatar img,#avatar video{will-change:transform,filter;transition:transform .18s ease, filter .18s ease}
    #avatar.talking img,#avatar.talking video{
      transform-origin:50% 28%;
      animation: headBobSmooth 1.25s ease-in-out infinite, fadeAI .25s ease forwards;
    }
    @keyframes headBobSmooth{
      0%{ transform: translateY(0) rotate(0deg) scale(1); filter: brightness(1); }
      25%{ transform: translateY(-0.6%) rotate(-0.12deg) scale(1.002); filter: brightness(1.02); }
      50%{ transform: translateY(0.15%) rotate(0.08deg) scale(1.001); filter: brightness(1.01); }
      75%{ transform: translateY(-0.4%) rotate(0.10deg) scale(1.003); filter: brightness(1.015); }
      100%{ transform: translateY(0) rotate(0deg) scale(1); filter: brightness(1); }
    }
    @keyframes fadeAI{from{opacity:.65} to{opacity:1}}

    #avatar::before{
      content:""; position:absolute; inset:-3%; border-radius:12px;
      background:
        radial-gradient(65% 60% at 50% 40%, rgba(32,163,74,.25), rgba(32,163,74,0) 60%),
        radial-gradient(60% 55% at 50% 70%, rgba(28,140,63,.18), rgba(28,140,63,0) 70%);
      opacity:0; pointer-events:none; filter: blur(6px); transform: scale(1);
      transition: opacity .15s ease;
    }
    #avatar.talking::before{opacity:.65; animation: haloBreath 1.25s ease-in-out infinite}
    @keyframes haloBreath{0%{transform:scale(1); filter:blur(6px)} 50%{transform:scale(1.03); filter:blur(7px)} 100%{transform:scale(1); filter:blur(6px)}}

    #avatar::after{
      content:""; position:absolute; left:8%; bottom:10%;
      width:26%; height:16%; pointer-events:none; opacity:0; transition: opacity .15s ease;
      --bar: linear-gradient(180deg, #5ff5a2 0%, #22b36a 100%);
      background: var(--bar), var(--bar), var(--bar), var(--bar), var(--bar);
      background-repeat:no-repeat;
      background-position:0% 100%, 25% 100%, 50% 100%, 75% 100%, 100% 100%;
      background-size:10% 22%, 10% 32%, 10% 18%, 10% 28%, 10% 24%;
      filter: drop-shadow(0 0 4px rgba(36,167,93,.35));
    }
    #avatar.talking::after{opacity:.95; animation: vuDance .24s linear infinite}
    #avatar.talking.talking-boost::after{ animation-duration:.16s }
    #avatar.talking.talking-boost img,
    #avatar.talking.talking-boost video{ animation-duration:1.05s }
    @keyframes vuDance{
      0%{   background-size:10% 24%, 10% 30%, 10% 18%, 10% 28%, 10% 22% }
      25%{  background-size:10% 70%, 10% 42%, 10% 38%, 10% 80%, 10% 48% }
      50%{  background-size:10% 36%, 10% 68%, 10% 52%, 10% 44%, 10% 76% }
      75%{  background-size:10% 82%, 10% 46%, 10% 74%, 10% 58%, 10% 40% }
      100%{ background-size:10% 28%, 10% 60%, 10% 26%, 10% 68%, 10% 32% }
    }

    #aiWave{
      position:fixed;left:0;right:0;bottom:0;height:4px;z-index:9999;
      background:linear-gradient(90deg, rgba(32,163,74,.2), rgba(32,163,74,.4), rgba(32,163,74,.2));
      background-size:400% 100%; animation: wave 4s infinite linear;
    }
    @keyframes wave{ from{background-position:0 0} to{background-position:400% 0} }

    #aiThinking{
      position:absolute; top:10px; right:12px; display:none;
      font-size:12px; color:#8bd8a9; opacity:.85; padding:4px 8px;
      background:rgba(0,0,0,.35); border:1px solid rgba(139,216,169,.5); border-radius:8px;
    }

    .insights{
      display:grid; grid-template-columns:1fr; gap:12px;
      padding:12px 14px; background:rgba(0,0,0,.14); border-top:1px solid rgba(255,255,255,.08)
    }

    .card h3{ margin:0 0 8px 0; font-size:15px; color:var(--viz-text); text-shadow: 0 1px 0 rgba(0,0,0,.35); }
    .viz{ width:100%; height:260px; display:block }
    .viz text{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", sans-serif;
    }

    .legend{display:flex; flex-wrap:wrap; gap:8px; font-size:12px; margin-top:8px}
    .badge{
      display:inline-flex; align-items:center; gap:6px;
      background:var(--chip-bg); color:var(--chip-text);
      border:1px solid var(--chip-border);
      border-radius:999px; padding:6px 10px;
      transition: background .15s ease, transform .12s ease;
    }
    .badge:hover{ background:var(--chip-bg-hover); transform:translateY(-1px) }
    .badge:focus-visible{ outline:2px solid var(--focus); outline-offset:2px }
    .dot{width:10px;height:10px;border-radius:50%}

    #vizTip{
      position:fixed; z-index:99999; pointer-events:none;
      background:#0f1216; color:#eaf7ef; border:1px solid rgba(255,255,255,.15);
      padding:6px 8px; font-size:12px; border-radius:8px; box-shadow:0 10px 24px rgba(0,0,0,.35);
      display:none; white-space:nowrap;
    }

    /* Modo claro */
    @media (prefers-color-scheme: light){
      :root{
        --bg:#f4f4f4; --text:#111; --panel:#fff; --card:#fff;
        --brand:#1c8c3f; --muted:#47515a; --focus:#22b36a;
        --viz-text:#0b0e11; --viz-muted:#47515a;
        --viz-bg:#ffffff; --viz-stroke:#d7dde3;

        --chip-bg:#ffffff; --chip-text:#0b0e11; --chip-border:rgba(0,0,0,.16);
        --chip-bg-hover:#f2f7f4;
      }
      body{ background:#f4f4f4; color:#111 }
      header{ background:#ffffff; border-bottom-color:#1c8c3f }
      .left,.right{ border-color: rgba(0,0,0,.08) }
      .qbtn{ background:#ffffff; color:#111 }
      .answer{ background:#ffffff }
      .card{ background:#ffffff }
    }

    /* OVERRIDES de fluidez del AVATAR (no animar el <video>) */
    #avatar video{ will-change:auto; transform:none; transition:filter .18s ease; }
    #avatar.talking video{ animation:none !important; transform:none !important; }
  </style>
</head>

<body>
  <!-- Fondos -->
  <div class="fx-grid" aria-hidden="true"></div>
  <div class="fx-glow" aria-hidden="true"></div>

  <header>
    <div class="brand">
      <img id="logoImg" class="logo" src="./Deloitte-Emblem.png" alt="Deloitte" loading="eager" decoding="async" />
      <span id="logoFallback" class="logo-fallback" aria-hidden="true">Deloitte</span>
      <h1>Asistente Virtual ‚Äì Marketplace Deloitte CA</h1>
    </div>

    <div class="controls" aria-label="Controles de voz y m√∫sica">
      <label for="voiceSel">Voz:
        <select id="voiceSel" title="Voz neutral latinoamericana" aria-label="Seleccionar voz"></select>
      </label>
      <button id="btnSpeak"  class="btn btn-primary" title="Reproducir √∫ltima respuesta">üîä Reproducir</button>
      <button id="btnPause"  class="btn btn-ghost"   title="Pausar/Reanudar audio">‚è∏Ô∏è Pausar</button>
      <button id="btnStop"   class="btn btn-ghost"   title="Detener audio">‚èπÔ∏è Detener</button>
      <button id="btnMusic"  class="btn btn-ghost"   title="Silenciar/activar m√∫sica de fondo">üîà M√∫sica</button>
    </div>
  </header>

  <main class="wrap">
    <!-- Izquierda: Avatar -->
    <section class="left">
      <div id="avatar" class="avatar" aria-label="Avatar hologr√°fico">
        <video id="avatarVideo"
               src="./Dise√±o sin t√≠tulo (5).mp4"
               muted
               loop
               playsinline
               preload="auto"></video>
        <div id="subtitle" class="subtitle" aria-live="polite"></div>
      </div>

      <div class="muted">
        Sugerencia: usa <span class="kbd">R</span> para reproducir/pausar,
        <span class="kbd">S</span> para detener y <span class="kbd">M</span> para silenciar m√∫sica.
      </div>
    </section>

    <!-- Derecha -->
    <section class="right">
      <div class="panel">
        <h2>Preguntas frecuentes ‚Äì Marketplace Deloitte CA</h2>
        <div class="controls">
          <small class="muted">Haz clic en una pregunta para ver la respuesta y reproducirla.</small>
        </div>
        <div id="aiThinking" aria-live="polite">Procesando‚Ä¶</div>
      </div>

      <!-- INSIGHTS (contenedor vac√≠o; sin tarjetas) -->
      <div class="insights" aria-label="Indicadores clave">
        <!-- Sin tarjetas -->
      </div>

<!-- ========= SERVICIO DE IMPUESTOS (Acorde√≥n simple, sin subt√≠tulos) ========= -->
<style>
  /* Estilos locales del acorde√≥n de impuestos (necesarios para colapsar/expandir) */
  .tax-card{
    background:#ffffff !important; color:#0b0e11 !important;
    border:1px solid rgba(0,0,0,.08) !important; border-radius:12px;
    box-shadow: 0 18px 40px rgba(0,0,0,.12), inset 0 1px 0 rgba(255,255,255,.06);
    margin:14px; padding:14px;
  }
  .tax-header{
    display:flex; gap:12px; align-items:center; justify-content:space-between;
    padding-bottom:8px; border-bottom:1px solid rgba(0,0,0,.08);
  }

  /* üî§ Mejora tipogr√°fica del titular (con mayor especificidad y !important) */
  #taxServices .tax-title{
    margin:0 !important;
    font-size:22px !important;          /* m√°s grande y visible */
    line-height:1.25 !important;         /* compacto pero legible */
    font-weight:800 !important;          /* peso alto para impacto */
    letter-spacing:0.2px !important;     /* leve tracking premium */
    color:#0b0e11 !important;
    display:flex !important; align-items:center !important; gap:8px !important;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Helvetica Neue", Arial, system-ui, sans-serif !important;
    -webkit-font-smoothing: antialiased; 
    -moz-osx-font-smoothing: grayscale;
  }

  .tax-toggle{
    margin-left:auto; background:#ffffff; color:#0b0e11; border:1px solid rgba(0,0,0,.12);
    border-radius:10px; padding:8px 10px; cursor:pointer;
  }
  .tax-toggle:focus-visible{ outline:2px solid var(--focus); outline-offset:2px; }
  .tax-desc{ margin:6px 0 0 0; color:#47515a; font-size:13px; }

  /* üîë Colapso maestro (cuerpo) */
  #taxServices .tax-body{ display:none; margin-top:12px; }
  #taxServices .tax-body.open{ display:block; }

  /* Lista de preguntas/respuestas */
  .accordion{ display:block; }
  .acc-q{
    width:100%; background:#ffffff; color:#0b0e11;
    border:1px solid rgba(0,0,0,.12); border-radius:10px;
    padding:12px; margin:6px 0; text-align:left; cursor:pointer;
    display:flex; justify-content:space-between; align-items:center; font-weight:600;
    box-shadow: 0 1px 0 rgba(255,255,255,.5) inset, 0 6px 14px rgba(0,0,0,.06);
    transition: box-shadow .18s ease, border-color .18s ease, background .18s ease;
  }
  .acc-q:hover{
    border-color: rgba(28,140,63,.35);
    box-shadow: 0 0 0 1px rgba(34,179,106,.18), 0 10px 22px rgba(0,0,0,.08);
    background:#f7faf8;
  }
  .acc-q .chev{ color:#1c8c3f; margin-left:12px; transition: transform .18s ease; }
  .acc-q[aria-expanded="true"] .chev{ transform: rotate(90deg); }

  /* üîë Colapso por pregunta */
  #taxServices .acc-a{
    display:none; padding:0 12px; background:#ffffff; color:#111;
    border:1px solid rgba(0,0,0,.08); border-radius:10px; margin:-2px 0 8px 0;
  }
  #taxServices .acc-a.open{ display:block; padding:12px; }
  #taxServices .acc-a p{ margin:0; }
</style>

<div id="taxServices" class="card tax-card" role="region" aria-label="Servicio de Impuestos">
  <div class="tax-header">
    <h3 class="tax-title">Servicio de Impuestos</h3>
    <button id="taxMasterToggle" class="tax-toggle" aria-expanded="false" aria-controls="taxBody">‚ñ∂ Ver preguntas</button>
  </div>

  <p class="tax-desc">Haz clic en ‚ÄúServicio de Impuestos‚Äù para desplegar las preguntas. Luego selecciona una pregunta para ver su respuesta.</p>

  <div id="taxBody" class="tax-body" role="region" aria-labelledby="taxMasterToggle">
    <div class="accordion">

      <!-- 1 -->
      <button class="acc-q" aria-expanded="false" aria-controls="acc-tax-1" id="acc-tax-1-btn">
        <span>¬øC√≥mo ayuda Deloitte a las organizaciones a simplificar y transformar su funci√≥n fiscal?</span><span class="chev">‚ñ∂</span>
      </button>
      <div class="acc-a" id="acc-tax-1" role="region" aria-labelledby="acc-tax-1-btn">
        <p>Deloitte combina experiencia, tecnolog√≠a e ideas innovadoras para simplificar procesos fiscales complejos y proporcionar visibilidad global que permita tomar decisiones estrat√©gicas informadas. Sus servicios incluyen cumplimiento, asesor√≠a e implementaci√≥n adaptados a las necesidades de cada organizaci√≥n.</p>
      </div>

      <!-- 2 -->
      <button class="acc-q" aria-expanded="false" aria-controls="acc-tax-2" id="acc-tax-2-btn">
        <span>¬øCu√°l es el enfoque de Deloitte para mejorar el cumplimiento fiscal en Latinoam√©rica?</span><span class="chev">‚ñ∂</span>
      </button>
      <div class="acc-a" id="acc-tax-2" role="region" aria-labelledby="acc-tax-2-btn">
        <p>Deloitte promueve un modelo de cumplimiento fiscal inteligente, transformando procesos tradicionales en esquemas m√°s √°giles, automatizados y confiables. Con herramientas como Tax Operate Platform, las empresas pueden generar reportes m√°s precisos, r√°pidos y sin errores.</p>
      </div>

      <!-- 3 -->
      <button class="acc-q" aria-expanded="false" aria-controls="acc-tax-3" id="acc-tax-3-btn">
        <span>¬øQu√© beneficios ofrece la plataforma Tax Operate Platform para la gesti√≥n tributaria?</span><span class="chev">‚ñ∂</span>
      </button>
      <div class="acc-a" id="acc-tax-3" role="region" aria-labelledby="acc-tax-3-btn">
        <p>Tax Operate Platform integra inteligencia artificial, automatizaci√≥n y profundo conocimiento fiscal para mejorar la calidad de la informaci√≥n, detectar riesgos y asegurar una respuesta oportuna ante autoridades fiscales. Permite anticiparse, optimizar y cumplir con plena seguridad.</p>
      </div>

      <!-- 4 -->
      <button class="acc-q" aria-expanded="false" aria-controls="acc-tax-4" id="acc-tax-4-btn">
        <span>¬øDe qu√© manera Deloitte apoya a empresas durante fusiones y adquisiciones desde el √°mbito fiscal?</span><span class="chev">‚ñ∂</span>
      </button>
      <div class="acc-a" id="acc-tax-4" role="region" aria-labelledby="acc-tax-4-btn">
        <p>El apoyo cubre m√∫ltiples √°reas durante todo el ciclo de vida de la transacci√≥n, ayudando a manejar riesgos en reestructuraci√≥n de cadena de suministro, propiedad intelectual, Fusiones y Adquisiciones y cr√©ditos gubernamentales. Adem√°s, se implementan estrategias pr√°cticas de gesti√≥n fiscal corporativa.</p>
      </div>

      <!-- 5 -->
      <button class="acc-q" aria-expanded="false" aria-controls="acc-tax-5" id="acc-tax-5-btn">
        <span>¬øQu√© papel juega la tecnolog√≠a en la transformaci√≥n de los departamentos de impuestos seg√∫n Deloitte?</span><span class="chev">‚ñ∂</span>
      </button>
      <div class="acc-a" id="acc-tax-5" role="region" aria-labelledby="acc-tax-5-btn">
        <p>Deloitte permite que los departamentos fiscales sean m√°s eficientes y efectivos, automatizando y agilizando procesos clave para liberar tiempo del talento fiscal y enfocarlos en actividades de alto valor.</p>
      </div>

      <!-- 6 -->
      <button class="acc-q" aria-expanded="false" aria-controls="acc-tax-6" id="acc-tax-6-btn">
        <span>¬øC√≥mo apoya Deloitte a empresas multinacionales en su estrategia fiscal global?</span><span class="chev">‚ñ∂</span>
      </button>
      <div class="acc-a" id="acc-tax-6" role="region" aria-labelledby="acc-tax-6-btn">
        <p>Ofrece asesor√≠a para implementar estrategias integradas, flexibles y sostenibles, alineando la posici√≥n fiscal corporativa con los objetivos de negocio y asegurando cumplimiento en m√∫ltiples jurisdicciones.</p>
      </div>

      <!-- 7 -->
      <button class="acc-q" aria-expanded="false" aria-controls="acc-tax-7" id="acc-tax-7-btn">
        <span>¬øQu√© valor aporta Deloitte en materia de precios de transferencia?</span><span class="chev">‚ñ∂</span>
      </button>
      <div class="acc-a" id="acc-tax-7" role="region" aria-labelledby="acc-tax-7-btn">
        <p>Deloitte ayuda a implementar un enfoque proactivo en precios de transferencia para mejorar procesos y pol√≠ticas, y ha sido reconocida por su excelencia, como lo demuestran premios regionales en esta √°rea.</p>
      </div>

      <!-- 8 -->
      <button class="acc-q" aria-expanded="false" aria-controls="acc-tax-8" id="acc-tax-8-btn">
        <span>¬øQu√© servicios brinda Deloitte para individuos de alto patrimonio y compa√±√≠as familiares?</span><span class="chev">‚ñ∂</span>
      </button>
      <div class="acc-a" id="acc-tax-8" role="region" aria-labelledby="acc-tax-8-btn">
        <p>Mediante Deloitte Private, se ofrece soporte en necesidades fiscales complejas, desde planificaci√≥n patrimonial hasta creaci√≥n, tenencia y monetizaci√≥n de activos intangibles, asegurando cumplimiento y estrategias √≥ptimas.</p>
      </div>

      <!-- 9 -->
      <button class="acc-q" aria-expanded="false" aria-controls="acc-tax-9" id="acc-tax-9-btn">
        <span>¬øC√≥mo contribuye Deloitte a la gesti√≥n de impuestos indirectos?</span><span class="chev">‚ñ∂</span>
      </button>
      <div class="acc-a" id="acc-tax-9" role="region" aria-labelledby="acc-tax-9-btn">
        <p>Deloitte permite una gesti√≥n proactiva de impuestos indirectos y flujos de caja, simplificando la supervisi√≥n fiscal y facilitando la toma de decisiones estrat√©gicas informadas.</p>
      </div>

      <!-- 10 -->
      <button class="acc-q" aria-expanded="false" aria-controls="acc-tax-10" id="acc-tax-10-btn">
        <span>¬øQu√© servicios de defensa fiscal ofrece Deloitte en caso de litigios?</span><span class="chev">‚ñ∂</span>
      </button>
      <div class="acc-a" id="acc-tax-10" role="region" aria-labelledby="acc-tax-10-btn">
        <p>Deloitte provee defensa en litigios fiscales y aduaneros, asistencia en fiscalizaciones y preparaci√≥n de consultas vinculantes ante autoridades tributarias, asegurando respaldo experto ante situaciones complejas.</p>
      </div>

      <!-- 11 -->
      <button class="acc-q" aria-expanded="false" aria-controls="acc-tax-11" id="acc-tax-11-btn">
        <span>¬øQu√© tipo de soporte brinda Deloitte a organizaciones gubernamentales?</span><span class="chev">‚ñ∂</span>
      </button>
      <div class="acc-a" id="acc-tax-11" role="region" aria-labelledby="acc-tax-11-btn">
        <p>Deloitte ayuda a modernizar y agilizar operaciones, incluyendo transformaci√≥n operativa, optimizaci√≥n en tecnolog√≠a fiscal y desarrollo de capacidades para la funci√≥n de tesorer√≠a.</p>
      </div>

      <!-- 12 -->
      <button class="acc-q" aria-expanded="false" aria-controls="acc-tax-12" id="acc-tax-12-btn">
        <span>¬øPor qu√© es importante la relaci√≥n cercana de Deloitte con las administraciones tributarias?</span><span class="chev">‚ñ∂</span>
      </button>
      <div class="acc-a" id="acc-tax-12" role="region" aria-labelledby="acc-tax-12-btn">
        <p>Su enfoque permite identificar y resolver situaciones antes de que se conviertan en contingencias, y facilitar un cumplimiento adecuado basado en conocimiento profundo de leyes y reglamentaciones.</p>
      </div>

      <!-- 13 -->
      <button class="acc-q" aria-expanded="false" aria-controls="acc-tax-13" id="acc-tax-13-btn">
        <span>¬øQu√© beneficios obtienen las empresas al automatizar los procesos fiscales?</span><span class="chev">‚ñ∂</span>
      </button>
      <div class="acc-a" id="acc-tax-13" role="region" aria-labelledby="acc-tax-13-btn">
        <p>Obtienen reducci√≥n de errores, mayor velocidad en la presentaci√≥n de reportes, identificaci√≥n temprana de riesgos y un modelo operativo que incrementa la confiabilidad y la eficiencia del √°rea fiscal.</p>
      </div>

      <!-- 14 -->
      <button class="acc-q" aria-expanded="false" aria-controls="acc-tax-14" id="acc-tax-14-btn">
        <span>¬øC√≥mo impulsa Deloitte la estrategia fiscal en fusiones y adquisiciones?</span><span class="chev">‚ñ∂</span>
      </button>
      <div class="acc-a" id="acc-tax-14" role="region" aria-labelledby="acc-tax-14-btn">
        <p>A trav√©s de su experiencia, Deloitte acompa√±a en valoraci√≥n, riesgo fiscal, precios de transferencia y estructuraci√≥n, asegurando que cada decisi√≥n est√© fundamentada y alineada con la estrategia global.</p>
      </div>

      <!-- 15 -->
      <button class="acc-q" aria-expanded="false" aria-controls="acc-tax-15" id="acc-tax-15-btn">
        <span>¬øQu√© reconocimientos recientes respaldan la calidad del servicio fiscal de Deloitte en Latinoam√©rica?</span><span class="chev">‚ñ∂</span>
      </button>
      <div class="acc-a" id="acc-tax-15" role="region" aria-labelledby="acc-tax-15-btn">
        <p>Deloitte S-LATAM fue reconocida con 14 premios en los ITR Americas Tax Awards 2025, destacando su liderazgo regional y excelencia t√©cnica en temas fiscales.</p>
      </div>

    </div>
  </div>
</div>
<!-- ========= FIN SERVICIO DE IMPUESTOS ========= -->
``


      <!-- ========= SERVICIOS LEGALES (Acorde√≥n doble nivel) ========= -->
      <style>
        .legal-card{
          background:#ffffff !important; color:#0b0e11 !important;
          border:1px solid rgba(0,0,0,.08) !important; border-radius:12px;
          box-shadow: 0 18px 40px rgba(0,0,0,.12), inset 0 1px 0 rgba(255,255,255,.06);
          margin:14px; padding:14px;
        }
        .legal-header{
          display:flex; gap:12px; align-items:center; justify-content:space-between;
          padding-bottom:8px; border-bottom:1px solid rgba(0,0,0,.08);
        }

        /* üî§ Mejora tipogr√°fica del titular (con mayor especificidad y !important) */
        #legalServices .legal-title{
          margin:0 !important;
          font-size:22px !important;
          line-height:1.25 !important;
          font-weight:800 !important;
          letter-spacing:0.2px !important;
          color:#0b0e11 !important;
          display:flex !important; align-items:center !important; gap:8px !important;
          font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Helvetica Neue", Arial, system-ui, sans-serif !important;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
        }

        .legal-toggle{
          margin-left:auto;
          background:#ffffff; color:#0b0e11; border:1px solid rgba(0,0,0,.12);
          border-radius:10px; padding:8px 10px; cursor:pointer;
        }
        .legal-toggle:focus-visible{ outline:2px solid var(--focus); outline-offset:2px; }
        .legal-desc{ margin:6px 0 0 0; color:#47515a; font-size:13px; }

        .legal-body{ display:none; margin-top:12px; }
        .legal-body.open{ display:block; }
      </style>

      <div id="legalServices" class="card legal-card" role="region" aria-label="Servicios Legales">
        <div class="legal-header">
          <h3 class="legal-title">Servicios Legales</h3>
          <button id="legalMasterToggle" class="legal-toggle" aria-expanded="false" aria-controls="legalBody">‚ñ∂ Ver preguntas</button>
        </div>
        <p class="legal-desc">Haz clic en ‚ÄúServicios Legales‚Äù para desplegar las preguntas. Luego selecciona una pregunta para ver su respuesta.</p>

        <div id="legalBody" class="legal-body" role="region" aria-labelledby="legalMasterToggle">
          <div class="accordion">
            <!-- 1 -->
            <button class="acc-q" aria-expanded="false" aria-controls="acc-legal-1" id="acc-legal-1-btn">
              <span>¬øQu√© propone Deloitte Legal con sus soluciones?</span><span class="chev">‚ñ∂</span>
            </button>
            <div class="acc-a" id="acc-legal-1" role="region" aria-labelledby="acc-legal-1-btn">
              <p>Deloitte Legal ofrece soluciones que fortalecen el negocio al combinar experiencia legal con un enfoque empresarial, ayudando a los departamentos jur√≠dicos a contribuir al crecimiento, gesti√≥n de riesgos y reducci√≥n de costos.</p>
            </div>
            <!-- 2 -->
            <button class="acc-q" aria-expanded="false" aria-controls="acc-legal-2" id="acc-legal-2-btn">
              <span>¬øC√≥mo puede Deloitte mejorar mi gesti√≥n de contratos?</span><span class="chev">‚ñ∂</span>
            </button>
            <div class="acc-a" id="acc-legal-2" role="region" aria-labelledby="acc-legal-2-btn">
              <p>Deloitte ayuda a las empresas a gestionar sus relaciones contractuales de negocio para mejorar la efectividad y desbloquear valor a lo largo de todo el ciclo de vida de los contratos.</p>
            </div>
            <!-- 3 -->
            <button class="acc-q" aria-expanded="false" aria-controls="acc-legal-3" id="acc-legal-3-btn">
              <span>¬øQu√© significa asesor√≠a en intangibles, datos y tecnolog√≠a?</span><span class="chev">‚ñ∂</span>
            </button>
            <div class="acc-a" id="acc-legal-3" role="region" aria-labelledby="acc-legal-3-btn">
              <p>Este servicio se enfoca en que las empresas comprendan, protejan, desarrollen y exploten activos intangibles (como datos, software o propiedad intelectual) que son cada vez m√°s cr√≠ticos para su valor competitivo.</p>
            </div>
            <!-- 4 -->
            <button class="acc-q" aria-expanded="false" aria-controls="acc-legal-4" id="acc-legal-4-btn">
              <span>¬øQu√© es la transformaci√≥n de la funci√≥n jur√≠dica?</span><span class="chev">‚ñ∂</span>
            </button>
            <div class="acc-a" id="acc-legal-4" role="region" aria-labelledby="acc-legal-4-btn">
              <p>Es un enfoque de consultor√≠a que ayuda a modernizar y aumentar el valor de la funci√≥n legal interna, mediante mejoras en procesos, tecnolog√≠a y gesti√≥n de riesgos para adaptarse a las necesidades del negocio.</p>
            </div>
            <!-- 5 -->
            <button class="acc-q" aria-expanded="false" aria-controls="acc-legal-5" id="acc-legal-5-btn">
              <span>¬øC√≥mo puede Deloitte Legal apoyarme en fusiones y adquisiciones?</span><span class="chev">‚ñ∂</span>
            </button>
            <div class="acc-a" id="acc-legal-5" role="region" aria-labelledby="acc-legal-5-btn">
              <p>Ofrecen acompa√±amiento integral en fusiones y adquisiciones (M&amp;A) y derecho corporativo, garantizando que las transacciones se realicen eficazmente y evitando problemas legales que puedan surgir en el proceso.</p>
            </div>
            <!-- 6 -->
            <button class="acc-q" aria-expanded="false" aria-controls="acc-legal-6" id="acc-legal-6-btn">
              <span>¬øQu√© aborda la "Ley de personas"?</span><span class="chev">‚ñ∂</span>
            </button>
            <div class="acc-a" id="acc-legal-6" role="region" aria-labelledby="acc-legal-6-btn">
              <p>Deloitte ayuda a las empresas a implementar estrategias legales s√≥lidas para atraer, motivar, proteger y retener el mejor talento, respondiendo a expectativas sociales y regulaciones laborales actuales.</p>
            </div>
            <!-- 7 -->
            <button class="acc-q" aria-expanded="false" aria-controls="acc-legal-7" id="acc-legal-7-btn">
              <span>¬øQu√© servicios incluye la asesor√≠a legal?</span><span class="chev">‚ñ∂</span>
            </button>
            <div class="acc-a" id="acc-legal-7" role="region" aria-labelledby="acc-legal-7-btn">
              <p>M√°s que cumplir con normas, la asesor√≠a de Deloitte Legal ofrece una perspectiva estrat√©gica, combinando legal, estrategia y tecnolog√≠a para resolver desaf√≠os y mejorar la posici√≥n competitiva de su negocio.</p>
            </div>
            <!-- 8 -->
            <button class="acc-q" aria-expanded="false" aria-controls="acc-legal-8" id="acc-legal-8-btn">
              <span>¬øQu√© son los Servicios Legales Gestionados?</span><span class="chev">‚ñ∂</span>
            </button>
            <div class="acc-a" id="acc-legal-8" role="region" aria-labelledby="acc-legal-8-btn">
              <p>Son soluciones dise√±adas para ayudar a los departamentos jur√≠dicos a lograr m√°s con menos, aumentando eficiencia, transparencia, previsibilidad y control del gasto legal mediante gesti√≥n de procesos repetitivos y uso de tecnolog√≠a especializada.</p>
            </div>
            <!-- 9 -->
            <button class="acc-q" aria-expanded="false" aria-controls="acc-legal-9" id="acc-legal-9-btn">
              <span>¬øQu√© mejoras concretas puedo esperar con Servicios Legales Gestionados?</span><span class="chev">‚ñ∂</span>
            </button>
            <div class="acc-a" id="acc-legal-9" role="region" aria-labelledby="acc-legal-9-btn">
              <p>Incluyen la gesti√≥n del ciclo de vida de contratos, manejo de entidades corporativas y apoyo en mapeo normativo, revisi√≥n de documentos, gesti√≥n de proyectos legales y otros servicios externalizados clave.</p>
            </div>
            <!-- 10 -->
            <button class="acc-q" aria-expanded="false" aria-controls="acc-legal-10" id="acc-legal-10-btn">
              <span>¬øPor qu√© Deloitte Legal puede ser un socio para decisiones comerciales?</span><span class="chev">‚ñ∂</span>
            </button>
            <div class="acc-a" id="acc-legal-10" role="region" aria-labelledby="acc-legal-10-btn">
              <p>Porque sus expertos combinan conocimiento jur√≠dico con entendimiento de negocio y tecnolog√≠a, aportando soluciones que reducen riesgos, generan valor y facilitan la toma de decisiones estrat√©gicas.</p>
            </div>
            <!-- 11 -->
            <button class="acc-q" aria-expanded="false" aria-controls="acc-legal-11" id="acc-legal-11-btn">
              <span>¬øDeloitte Legal opera en m√∫ltiples pa√≠ses y sectores?</span><span class="chev">‚ñ∂</span>
            </button>
            <div class="acc-a" id="acc-legal-11" role="region" aria-labelledby="acc-legal-11-btn">
              <p>S√≠, Deloitte Legal est√° presente en m√°s de 75 pa√≠ses y sus profesionales colaboran a nivel global para brindar soluciones integrales, adaptadas al contexto espec√≠fico del cliente y su industria.</p>
            </div>
            <!-- 12 -->
            <button class="acc-q" aria-expanded="false" aria-controls="acc-legal-12" id="acc-legal-12-btn">
              <span>¬øQu√© tipo de retos ayuda a resolver Deloitte Legal?</span><span class="chev">‚ñ∂</span>
            </button>
            <div class="acc-a" id="acc-legal-12" role="region" aria-labelledby="acc-legal-12-btn">
              <p>Desde cambios regulatorios complejos hasta integraci√≥n de nuevas tecnolog√≠as y protecci√≥n de activos digitales, Deloitte Legal trabaja para que las empresas naveguen entornos legales y comerciales en constante cambio.</p>
            </div>
          </div>
        </div>
      </div>
      <!-- ========= FIN SERVICIOS LEGALES ========= -->
<!-- ========= TARJETA DE INFORMACI√ìN / CONTACTO ========= -->
<style>
  /* Estilos SOLO para esta tarjeta de informaci√≥n */
  .info-card{
    background:#ffffff !important; color:#0b0e11 !important;
    border:1px solid rgba(0,0,0,.08) !important; border-radius:12px;
    box-shadow:0 18px 40px rgba(0,0,0,.12); margin:14px; padding:16px;
  }
  .info-card h3{
    margin:0 0 6px 0; font-size:18px; font-weight:800; color:#0b0e11;
  }
  .info-card p{ margin:8px 0 0 0; color:#47515a; font-size:14px; }
  .highlight-blue{ color:#0b6efd !important; font-weight:700; text-decoration:none; }
  .highlight-blue:hover, .highlight-blue:focus{ text-decoration:underline; }
</style>

<div id="contactInfoCard" class="card info-card" role="region" aria-label="Informaci√≥n de contacto Deloitte">
  <h3>¬øNecesita comunicarse con Deloitte?</h3>
  <p>
    Si desea comunicarse con Deloitte, escr√≠banos a
    <a href="mailto:dgen_CA@deloitte.com"
       class="highlight-blue"
       aria-label="Escribir a dgen guion bajo CA arroba deloitte punto com">
      dgen_CA@deloitte.com
    </a>,
    con gusto atenderemos sus consultas.
  </p>
</div>
<!-- ========= FIN TARJETA DE INFORMACI√ìN ========= -->
      <!-- FAQ base -->
      <div class="grid" id="faqGrid" role="list">
       
      </div>

      <div id="answerBox" class="answer" aria-live="polite">
        Bienvenido/a. Selecciona una pregunta para ver la respuesta y reproducirla con voz.
      </div>

      <footer>
        ¬© 2026 Deloitte &amp; Touche, S.A. ‚Äî Demostraci√≥n de asistente con TTS. Recomendado: Chrome/Edge.
      </footer>
    </section>
  </main>

  <!-- M√∫sica corporativa -->
  <audio id="bgMusic" src="./musica-corporativa.mp3" preload="auto" loop></audio>

  <!-- Tooltip global de gr√°ficos -->
  <div id="vizTip" role="tooltip" aria-hidden="true"></div>

  <!-- Onda AI decorativa -->
  <div id="aiWave" aria-hidden="true"></div>

  <script>
    "use strict";

    /* Fallback logo */
    (function(){
      const img = document.getElementById('logoImg');
      const fb  = document.getElementById('logoFallback');
      if (!img) return;
      img.addEventListener('error', () => { img.style.display='none'; fb.style.display='inline-flex'; }, { once:true });
      if (img.complete && !img.naturalWidth){ img.style.display='none'; fb.style.display='inline-flex'; }
    })();

    /* ====== Q&A + TTS + Avatar ====== */
    document.addEventListener('DOMContentLoaded', () => {
      const voiceSel   = document.getElementById('voiceSel');
      const btnSpeak   = document.getElementById('btnSpeak');
      const btnPause   = document.getElementById('btnPause');
      const btnStop    = document.getElementById('btnStop');
      const btnMusic   = document.getElementById('btnMusic');
      const faqGrid    = document.getElementById('faqGrid');
      const answerBox  = document.getElementById('answerBox');
      const subtitleEl = document.getElementById('subtitle');
      const aiThinking = document.getElementById('aiThinking');
      const bg         = document.getElementById('bgMusic');
      const avatar     = document.getElementById('avatar');
      const avatarVideo= document.getElementById('avatarVideo');

      if (!voiceSel || !btnSpeak || !btnPause || !btnStop || !faqGrid || !answerBox || !subtitleEl){
        if (answerBox) answerBox.textContent = 'Faltan nodos esenciales; verifica el HTML.';
        return;
      }

      // M√∫sica al primer clic (autoplay policy)
      document.addEventListener("click", ()=>{
        if(bg && bg.paused){
          bg.volume = 0.18;
          bg.play().catch(()=>{});
        }
      }, {once:true});
      if (btnMusic && bg){
        btnMusic.addEventListener('click', ()=>{ bg.muted = !bg.muted; btnMusic.textContent = bg.muted ? 'üîá M√∫sica' : 'üîà M√∫sica'; });
      }

      // Typewriter
      let typeSeq = 0;
      function typeText(target, text, speed=22){
        typeSeq++;
        const mySeq = typeSeq;
        target.textContent = "";
        let i = 0;
        (function step(){
          if(mySeq !== typeSeq) return;
          if(i < text.length){
            target.textContent += text[i++];
            setTimeout(step, speed);
          }
        })();
      }

      // Avatar hablando
      function setTalking(on){ if(avatar) avatar.classList.toggle('talking', !!on); }
      function playAvatarVideo(){ avatarVideo && avatarVideo.play().catch(()=>{}); }
      function pauseAvatarVideo(){ avatarVideo && avatarVideo.pause(); }
      function stopAvatarVideo(){ if(!avatarVideo) return; try{ avatarVideo.pause(); avatarVideo.currentTime = 0; }catch{} }

      // TTS
      const synth = ('speechSynthesis' in window) ? window.speechSynthesis : null;
      let voices = [], voicesReady = false, lastUtterance = null, queuedText = null;

      function loadVoices(){
        voiceSel.innerHTML = '';
        if (!synth){
          const opt = document.createElement('option');
          opt.textContent = 'TTS no disponible'; opt.value = '';
          voiceSel.appendChild(opt); voiceSel.disabled = true; voicesReady = false; return;
        }
        voices = synth.getVoices() || [];
        if (!voices.length){
          const opt = document.createElement('option');
          opt.textContent = 'Cargando voces‚Ä¶'; opt.value = '';
          voiceSel.appendChild(opt); voicesReady = false; return;
        }
        voices.forEach(v => {
          const opt = document.createElement('option');
          opt.value = v.name;
          opt.textContent = `${v.name} ‚Äî ${v.lang}${v.default ? ' (predeterminada)' : ''}`;
          voiceSel.appendChild(opt);
        });
        const preferred = [
          /spanish.*(mexico|latin|latino)/i,
          /esmx|ar|cl|co|pe|uy|bo|py|ec|ve/i,
          /spanish.*(united states)/i,
          /spanish|es/i
        ];
        for (const rx of preferred) {
          const match = voices.find(v => rx.test(`${v.name} ${v.lang}`));
          if (match) { voiceSel.value = match.name; break; }
        }
        voicesReady = true;
        if (queuedText){ const t = queuedText; queuedText = null; speakNow(t); }
      }
      loadVoices();
      if (synth && 'onvoiceschanged' in synth) synth.onvoiceschanged = loadVoices;

      function getSelectedVoice(){
        if (!voices.length) return null;
        const name = voiceSel.value;
        return voices.find(v => v.name === name)
            || voices.find(v => /spanish|es/i.test(v.lang))
            || voices[0];
      }

      function queueSpeak(text){
        if (!synth || !text) return;
        if (!voicesReady){ queuedText = text; setTimeout(loadVoices, 250); return; }
        speakNow(text);
      }

      function speakNow(text){
        try{
          synth.cancel();
          const u = new SpeechSynthesisUtterance(text);
          const v = getSelectedVoice();
          if (v) u.voice = v;
          u.lang = (v && v.lang) ? v.lang : 'es-ES';
          u.rate = 1; u.pitch = 1; u.volume = 1;

          u.onstart   = () => { aiThinking.style.display='none'; setTalking(true); playAvatarVideo(); };
          u.onend     = () => { setTalking(false); stopAvatarVideo(); };
          u.onerror   = () => { setTalking(false); stopAvatarVideo(); aiThinking.style.display='none'; };

          lastUtterance = u;
          synth.speak(u);
        } catch(e){
          aiThinking.style.display='none';
        }
      }

      // Click en preguntas del FAQ
      faqGrid.querySelectorAll('.qbtn').forEach(btn => {
        btn.onclick = () => {
          const text = btn.dataset.answer || '';
          aiThinking.style.display='block';
          typeText(answerBox, text);
          subtitleEl.textContent = text;
          queueSpeak(text);
        };
      });

      // Bot√≥n Reproducir (relee la respuesta actual)
      btnSpeak.onclick = () => {
        const text = (answerBox.textContent || '').trim();
        if (text) queueSpeak(text);
      };

      // Exponer helpers globales
      window.typeText = typeText;
      window.queueSpeak = queueSpeak;

      // Mensaje inicial
      const bienvenida = 'Bienvenido/a. Selecciona una pregunta para ver la respuesta y reproducirla con voz.';
      typeText(answerBox, bienvenida);
      subtitleEl.textContent = bienvenida;

      /* ====== Acorde√≥n maestro de Servicio de Impuestos ====== */
      (function(){
        const card = document.getElementById('taxServices');
        const masterBtn = document.getElementById('taxMasterToggle');
        const body = document.getElementById('taxBody');
        if (!card || !masterBtn || !body) return;

        let open = false; // cambia a true si lo quieres abierto por defecto
        function sync(){
          body.classList.toggle('open', open);
          masterBtn.setAttribute('aria-expanded', open ? 'true':'false');
          masterBtn.textContent = open ? '‚ñº Ocultar preguntas' : '‚ñ∂ Ver preguntas';
        }
        sync();

        masterBtn.addEventListener('click', () => { open = !open; sync(); });

        function speakIfAvailable(text){
          try{
            const subtitle = document.getElementById('subtitle');
            if (subtitle) subtitle.textContent = text;
            if (typeof window.queueSpeak === 'function') window.queueSpeak(text);
          }catch(_){}
        }

        // Inicial: todo cerrado
        card.querySelectorAll('.acc-a').forEach(p => {
          p.style.display = 'none';
          p.classList.remove('open');
        });

        // Toggle preguntas -> respuestas
        card.addEventListener('click', (e)=>{
          const btn = e.target.closest('.acc-q');
          if(!btn || !card.contains(btn)) return;

          const panelId = btn.getAttribute('aria-controls');
          const panel = document.getElementById(panelId);
          if (!panel) return;

          const isOpen = panel.classList.contains('open');
          btn.setAttribute('aria-expanded', isOpen ? 'false' : 'true');

          if (isOpen){
            panel.classList.remove('open');
            panel.style.display = 'none';
          } else {
            // cerrar otras abiertas
            card.querySelectorAll('.acc-a.open').forEach(p=>{
              if (p !== panel){
                p.classList.remove('open');
                p.style.display = 'none';
                const otherBtn = card.querySelector('[aria-controls="'+p.id+'"]');
                if (otherBtn) otherBtn.setAttribute('aria-expanded','false');
              }
            });

            panel.style.display = 'block';
            panel.classList.add('open');

            const text = (panel.textContent || '').trim();
            if (text) speakIfAvailable(text);
          }
        });
      })();
    });

    /* ==== Helpers addQA/bulkAddQA + renumeraci√≥n ==== */
    (function(){
      const grid = document.getElementById('faqGrid');
      if(!grid) return;

      window.addQA = function(questionText, answerText){
        const btn = document.createElement('button');
        btn.className = 'qbtn';
        btn.setAttribute('role','listitem');
        btn.textContent = questionText;
        btn.dataset.answer = answerText;

        btn.onclick = () => {
          const text = btn.dataset.answer || '';
          const aiThinking = document.getElementById('aiThinking');
          if (aiThinking) aiThinking.style.display='block';

          const answerBox  = document.getElementById('answerBox');
          const subtitleEl = document.getElementById('subtitle');
          if (answerBox && subtitleEl){
            if (typeof window.typeText === 'function'){ window.typeText(answerBox, text); }
            else { answerBox.textContent = text; }
            subtitleEl.textContent = text;
          }
          if (typeof window.queueSpeak === 'function') window.queueSpeak(text);
          if (aiThinking) setTimeout(()=> aiThinking.style.display='none', 100);
        };

        grid.appendChild(btn);
      };

      window.bulkAddQA = function(list){ (list || []).forEach(item => addQA(item.q, item.a)); };

      function renumberFAQ() {
        const items = [...grid.querySelectorAll('.qbtn')];
        items.forEach((btn, idx) => {
          const text = btn.textContent.replace(/^\d+\.\s*/, "").trim();
          btn.textContent = `${idx + 1}. ${text}`;
        });
      }
      renumberFAQ();

      const oldAddQA = window.addQA;
      if (typeof oldAddQA === "function") {
        window.addQA = function(q, a){ oldAddQA(q, a); renumberFAQ(); };
      }
      const oldBulk = window.bulkAddQA;
      if (typeof oldBulk === "function") {
        window.bulkAddQA = function(list){ oldBulk(list); renumberFAQ(); };
      }
    })();

    /* ==== Parche robusto Pausar/Detener TTS ==== */
    (function(){
      if (!('speechSynthesis' in window)) return;

      const synth    = window.speechSynthesis;
      const btnPause = document.getElementById('btnPause');
      const btnStop  = document.getElementById('btnStop');
      const btnSpeak = document.getElementById('btnSpeak');
      const answerBox  = document.getElementById('answerBox');
      const avatarEl   = document.getElementById('avatar');
      const avatarVideo= document.getElementById('avatarVideo');

      function setTalking(on){ avatarEl && avatarEl.classList.toggle('talking', !!on); }
      function playAvatarVideo(){ avatarVideo && avatarVideo.play().catch(()=>{}); }
      function stopAvatarVideo(){ if(!avatarVideo) return; try{ avatarVideo.pause(); avatarVideo.currentTime = 0; }catch{} }

      function setBtnLabels(){
        if (!btnPause) return;
        if (synth.paused)       btnPause.textContent = '‚ñ∂ Reanudar';
        else if (synth.speaking)btnPause.textContent = '‚è∏Ô∏è Pausar';
        else                    btnPause.textContent = '‚è∏Ô∏è Pausar';
      }
      function hardCancel(){
        try { synth.cancel(); } catch {}
        setTalking(false);
        stopAvatarVideo();
        setBtnLabels();
      }
      function pauseResume(e){
        e && e.preventDefault();
        if (!synth) return;
        if (synth.speaking && !synth.paused){
          try { synth.pause(); } catch {}
          setTalking(false);
          setBtnLabels();
          return;
        }
        if (synth.paused){
          try { synth.resume(); } catch {}
          setTimeout(()=>{ if (synth.speaking && !synth.paused) { setTalking(true); playAvatarVideo(); } }, 30);
          setBtnLabels();
          return;
        }
        const last = (answerBox && (answerBox.textContent||'').trim()) || '';
        if (last && typeof window.queueSpeak === 'function'){ window.queueSpeak(last); }
      }
      function stopAll(e){
        e && e.preventDefault();
        if (!synth) return;
        hardCancel();
      }

      if (btnPause){ btnPause.onclick = pauseResume; }
      if (btnStop ){ btnStop .onclick = stopAll; }

      if (btnSpeak){
        const orig = btnSpeak.onclick;
        btnSpeak.onclick = function(ev){
          hardCancel();
          if (typeof orig === 'function') orig.call(this, ev);
        };
      }

      const visInterval = setInterval(setBtnLabels, 250);
      window.addEventListener('beforeunload', () => clearInterval(visInterval));
    })();
  </script>

  <!-- Script independiente para el acorde√≥n de Servicios Legales -->
  <script>
    (function(){
      const card = document.getElementById('legalServices');
      const masterBtn = document.getElementById('legalMasterToggle');
      const body = document.getElementById('legalBody');
      if (!card || !masterBtn || !body) return;

      // Por defecto CERRADO (cambia a true si deseas que inicie abierto)
      let open = false;
      function sync(){
        body.classList.toggle('open', open);
        masterBtn.setAttribute('aria-expanded', open ? 'true':'false');
        masterBtn.textContent = open ? '‚ñº Ocultar preguntas' : '‚ñ∂ Ver preguntas';
      }
      sync();

      masterBtn.addEventListener('click', () => { open = !open; sync(); });

      function speakIfAvailable(text){
        try{
          const subtitle = document.getElementById('subtitle');
          if (subtitle) subtitle.textContent = text;
          if (typeof window.queueSpeak === 'function') window.queueSpeak(text);
        }catch(_){}
      }

      // Inicial: todo cerrado
      card.querySelectorAll('.acc-a').forEach(p => {
        p.style.display = 'none';
        p.classList.remove('open');
      });

      // Acorde√≥n interno
      card.addEventListener('click', (e)=>{
        const btn = e.target.closest('.acc-q');
        if(!btn || !card.contains(btn)) return;

        const panelId = btn.getAttribute('aria-controls');
        const panel = document.getElementById(panelId);
        if (!panel) return;

        const isOpen = panel.classList.contains('open');
        btn.setAttribute('aria-expanded', isOpen ? 'false' : 'true');

        if (isOpen){
          panel.classList.remove('open');
          panel.style.display = 'none';
        } else {
          // Cerrar otros
          card.querySelectorAll('.acc-a.open').forEach(p=>{
            if (p !== panel){
              p.classList.remove('open');
              p.style.display = 'none';
              const otherBtn = card.querySelector('[aria-controls="'+p.id+'"]');
              if (otherBtn) otherBtn.setAttribute('aria-expanded','false');
            }
          });

          panel.style.display = 'block';
          panel.classList.add('open');

          const text = (panel.textContent || '').trim();
          if (text) speakIfAvailable(text);
        }
      });
    })();
  </script>
<script>
  // Hace que el avatar (y la tarjeta) lean el mensaje de contacto al hacer clic
  (function(){
    const MSG = "Si desea comunicarse con Deloitte, escr√≠banos a dgen_CA arroba deloitte punto com, con gusto atenderemos sus consultas.";

    function speakContact(){
      try{
        if (typeof window.queueSpeak === "function") window.queueSpeak(MSG);

        const answerBox  = document.getElementById('answerBox');
        const subtitleEl = document.getElementById('subtitle');

        if (answerBox){
          if (typeof window.typeText === "function") window.typeText(answerBox, MSG);
          else answerBox.textContent = MSG;
        }
        if (subtitleEl) subtitleEl.textContent = MSG;
      }catch(_){}
    }

    document.addEventListener("DOMContentLoaded", () => {
      const avatar = document.getElementById("avatar");
      if (avatar) avatar.addEventListener("click", speakContact);

      const card = document.getElementById("contactInfoCard");
      if (card){
        card.style.cursor = "pointer";
        card.setAttribute("tabindex", "0");
        card.setAttribute("role", "button");
        card.addEventListener("click", speakContact);
        card.addEventListener("keydown", (ev) => {
          if (ev.key === "Enter" || ev.key === " ") { ev.preventDefault(); speakContact(); }
        });
      }
    });
  })();
</script>
  <!-- M√∫sica corporativa (preferencia persistente) -->
  <script>
  (function(){
    const bg  = document.getElementById('bgMusic');
    const btn = document.getElementById('btnMusic');
    if (!bg) return;

    const LS_KEY = 'bgMusicMuted';
    const saved = localStorage.getItem(LS_KEY);
    bg.muted = (saved === 'true');
    bg.volume = 0.18;
    if (bg.hasAttribute('muted') && saved !== 'true') bg.removeAttribute('muted');

    function syncBtn(){
      if (!btn) return;
      btn.textContent = bg.muted ? 'üîá M√∫sica' : 'üîà M√∫sica';
      btn.setAttribute('aria-pressed', bg.muted ? 'true' : 'false');
      btn.setAttribute('aria-label', bg.muted ? 'M√∫sica silenciada' : 'M√∫sica activa');
    }
    syncBtn();

    async function tryPlay(){ try { await bg.play(); } catch(_) {} }
    const unlock = async () => {
      if (bg.paused) await tryPlay();
      window.removeEventListener('click', unlock);
      window.removeEventListener('keydown', unlock);
    };
    window.addEventListener('click',  unlock, { once:true });
    window.addEventListener('keydown', unlock, { once:true });

    if (btn){
      btn.addEventListener('click', async () => {
        bg.muted = !bg.muted;
        localStorage.setItem(LS_KEY, String(bg.muted));
        syncBtn();
        if (!bg.muted && bg.paused) await tryPlay();
      });

      btn.addEventListener('click', (e) => {
        if (e.shiftKey){
          localStorage.removeItem(LS_KEY);
          bg.muted = false;
          syncBtn();
        }
      }, { capture:true });
    }

    document.addEventListener('keydown', async (e) => {
      if ((e.key || '').toLowerCase() === 'm'){
        bg.muted = !bg.muted;
        localStorage.setItem(LS_KEY, String(bg.muted));
        syncBtn();
        if (!bg.muted && bg.paused) await tryPlay();
      }
    });
  })();
  </script>

  <!-- Parche-ES v2 (se mantiene; no interfiere con cambios) -->
  <script>
  (() => {
    "use strict";
    const css = `
      :root{ color-scheme: light !important; }
      body{ background:#f4f4f4 !important; color:#111 !important; }
      header{ background:#ffffff !important; border-bottom-color:#1c8c3f !important; }
      .left,.right{ border-color: rgba(0,0,0,.08) !important; }
      .grid{ background:rgba(246,250,247,1) !important; }
      .card{ background:#ffffff !important; color:#111 !important; }
      .qbtn{
        background:#ffffff !important; color:#111 !important;
        border-color: rgba(0,0,0,.08) !important; display:block !important;
      }
      .answer{ background:#ffffff !important; color:#111 !important; border-color: rgba(0,0,0,.08) !important; }
      .subtitle{
        background: rgba(255,255,255,.82) !important; color:#0b0e11 !important;
        border:1px solid rgba(0,0,0,.08) !important;
      }
      .fx-grid{ mix-blend-mode: normal !important; opacity:.75 !important; }
      #vizTip{
        background:#ffffff !important; color:#0b0e11 !important;
        border-color: rgba(0,0,0,.15) !important; box-shadow:0 10px 24px rgba(0,0,0,.12) !important;
      }
      .viz text{ fill:#0b0e11 !important; }
    `;
    const style = document.createElement('style');
    style.setAttribute('data-force-light','1');
    style.textContent = css;
    document.head.appendChild(style);

    const meta = document.createElement('meta');
    meta.name = 'google'; meta.content = 'notranslate';
    document.head.appendChild(meta);

    const synth = ('speechSynthesis' in window) ? window.speechSynthesis : null;
    const voiceSel = document.getElementById('voiceSel');

    function spanishFilter(list){
      return (list||[]).filter(v=>{
        const tag = (v.lang||'').toLowerCase();
        const name= (v.name||'').toLowerCase();
        return (
          /^es(-|$)/.test(tag) ||
          /es-419|es-cr|es-mx|es-pa|es-gt|es-sv|es-ni|es-hn|es-do|es-co|es-ar|es-cl|es-pe|es-uy|es-bo|es-py|es-ec|es-ve/.test(tag) ||
          /spanish|espa√±ol/.test(name)
        );
      });
    }
    function prefScore(v){
      const t = ((v.lang||'') + ' ' + (v.name||'')).toLowerCase();
      let s = 0;
      if (/es-cr/.test(t)) s += 50;
      if (/es-419/.test(t)) s += 40;
      if (/es-mx|es-pa|es-gt|es-sv|es-ni|es-hn|es-do/.test(t)) s += 35;
      if (/es-co|es-ar|es-cl|es-pe|es-uy|es-bo|es-py|es-ec|es-ve/.test(t)) s += 25;
      if (/^es/.test((v.lang||''))) s += 10;
      if (/(female|femenina|mujer)/i.test(t)) s += 6;
      return s;
    }
    function refillSelect(){
      if (!synth || !voiceSel) return;
      const all = synth.getVoices() || [];
      const es = spanishFilter(all);
      if (!es.length){
        voiceSel.innerHTML = '';
        const opt = document.createElement('option');
        opt.value = '';
        opt.textContent = 'Espa√±ol (autom√°tico)';
        voiceSel.appendChild(opt);
        voiceSel.disabled = true;
        return;
      }
      es.sort((a,b)=>prefScore(b)-prefScore(a));

      const prev = voiceSel.value;
      voiceSel.innerHTML = '';

      const preferredFemale = es.find(v => /(female|femenina|mujer)/i.test(((v.lang||'')+' '+(v.name||'')).toLowerCase()));
      const finalOrder = preferredFemale ? [preferredFemale, ...es.filter(v => v !== preferredFemale)] : es;

      finalOrder.forEach(v=>{
        const labelBase = v.name.replace(/Google\s*|Microsoft\s*/gi,'').trim();
        const lab = `${labelBase} ‚Äî ${v.lang}`;
        const opt = document.createElement('option');
        opt.value = v.name; opt.textContent = lab;
        voiceSel.appendChild(opt);
      });

      const found = finalOrder.find(v => v.name === prev) || finalOrder[0];
      voiceSel.value = found.name;
      voiceSel.disabled = false;
    }
    function ensureSpanishSelected(){
      if (!voiceSel || voiceSel.disabled) return;
      const txt = (voiceSel.options[voiceSel.selectedIndex]?.text || '').toLowerCase();
      if (!/es-|spanish|espa√±ol/.test(txt)){
        voiceSel.selectedIndex = 0;
      }
    }
    if (synth){
      synth.onvoiceschanged = () => { refillSelect(); ensureSpanishSelected(); };
      let tries = 0;
      const t = setInterval(()=>{
        refillSelect(); ensureSpanishSelected();
        if (++tries > 10 || (voiceSel && voiceSel.options.length)) clearInterval(t);
      }, 250);
    }

    try{
      if ('SpeechSynthesisUtterance' in window && !window.__ssu_es419_patched__){
        const Native = window.SpeechSynthesisUtterance;
        function Patched(text){
          const u = new Native(text);
          if (!u.lang || !/^es(-|$)/i.test(u.lang)) u.lang = 'es-419';
          return u;
        }
        Patched.prototype = Native.prototype;
        Object.setPrototypeOf(Patched, Native);
        window.SpeechSynthesisUtterance = Patched;
        window.__ssu_es419_patched__ = true;
      }
    } catch(_) {}
  })();
  </script>
</body>
</html>











